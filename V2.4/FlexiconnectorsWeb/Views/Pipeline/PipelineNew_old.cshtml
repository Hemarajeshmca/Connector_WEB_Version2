@model List<ConnectionDto>
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>


    .demo-wrapper {
        grid-template-columns: 180px 1fr;
    }

    .k-h4 {
        line-height: 26px;
        margin-bottom: 0;
    }

    .k-window-titlebar {
        display: none !important;
        background-color: transparent !important;
    }

    .kd-nodata-wrapper {
        display: block !important;
        padding-top: 20px !important;
    }


    /* Breakpoints for full screen demo: max:599px, min:759px and max: 959 */

    .demo-wrapper {
        grid-template-columns: 1fr;
    }

    .avatar {
        display: block !important;
    }

    .side-container {
        display: none !important;
    }

    .main-container {
        padding-bottom: 0;
    }

    .content-expanded {
        border-end-end-radius: 0;
        border-end-start-radius: 0;
    }


    /* Breakpoint for full screen demo: max:359px */

    .avatar {
        width: 32px;
        height: 32px;
    }

    html.k-webkit.k-webkit114 {
        overflow: hidden;
    }

    div.k-window-content {
        overflow: hidden;
        box-shadow: 0 0 8px 8px rgba(153, 153, 153, 0.8) !important;
    }

    }

    .k-window-title {
        position: absolute;
        left: 9.44em;
        right: 0.44em;
        overflow: hidden;
        cursor: default;
        text-overflow: ellipsis;
        font-weight: bold;
        color: green;
        display: none;
    }

    div.k-window {
        box-shadow: 0 0 8px 8px rgba(153, 153, 153, 0.8) !important;
        padding-top: 0px !important;
    }

</style>
<style>

    .show {
        display: block;
    }

    * {
        margin: 0;
        padding: 0;
    }

    html {
        height: 100%;
    }

    /*form styles*/
    #msform {
        text-align: center;
        position: relative;
        padding: 0px 10px;
    }
  
    .k-grid-md td, .k-grid-md .k-table-td {
        padding-block: 5px !important;
    }

    .k-grid {
        border-width: 1px;
        border-style: solid;
        box-sizing: border-box;
        outline: 0;
        font-family: inherit;
        font-size: 14px;
        line-height: 1.4285714286;
        display: flex;
        flex-direction: column;
        position: relative;
        -webkit-touch-callout: none;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    }

    .navbar {
        margin-bottom: 0px !important;
    }

    #msform fieldset .form-card {
        margin: 0px !important;
        border: 0 none;
        background: #fff;
        border-radius: 0px;
        box-shadow: 0 2px 2px 2px rgba(0, 0, 0, 0.2);
        padding: 20px 29px 30px 43px;
        box-sizing: border-box;
        margin: 0 3% 20px 3%;
        width: 100%;
        /*stacking fieldsets above each other*/
        position: relative;
        height: 67vh;
    }

    #msform fieldset {
        background: white;
        border: 0 none;
        border-radius: 0.5rem;
        box-sizing: border-box;
        margin: 0;
        padding-bottom: 20px;
        /*stacking fieldsets above each other*/
        position: relative;
        background-color: transparent;
    }

        /*Hide all except first fieldset*/
        #msform fieldset:not(:first-of-type) {
            display: none;
        }

        #msform fieldset .form-card {
            text-align: left;
            height: 60vh;
        }

    /*Blue Buttons*/
    #msform .action-button {
        width: 100px;
        background: #0fc9b7;
        border-radius: 5px;
        font-weight: bold;
        color: #ffff;
        border: 0 none;
        border-radius: 5px;
        cursor: pointer;
        padding: 10px 5px;
        margin: 10px 5px;
    }
/*
        #msform .action-button:hover, #msform .action-button:focus {
            box-shadow: 0 0 0 2px white, 0 0 0 3px skyblue;
        }*/

    /*Previous Buttons*/
    #msform .action-button-previous {
        width: 100px;
        border: 1px solid red !important;
        background: transparent;
        font-weight: bold;
        color: red;
        border: 0 none;
        border-radius: 5px !important;
        cursor: pointer;
        padding: 10px 5px;
        margin: 10px 5px;
    }

     /*   #msform .action-button-previous:hover, #msform .action-button-previous:focus {
            box-shadow: 0 0 0 2px white, 0 0 0 3px #616161;
        }*/

    /*Dropdown List Exp Date*/
    select.list-dt {
        border: none;
        outline: 0;
        border-bottom: 1px solid #ccc;
        padding: 2px 5px 3px 5px;
        margin: 2px;
    }

        select.list-dt:focus {
            border-bottom: 2px solid skyblue;
        }

    /*The background card*/
    .card1 {
        z-index: 0;
        border: none;
        border-radius: 0.5rem;
        position: relative;
    }

    /*FieldSet headings*/
    .fs-title {
        font-size: 25px;
        color: #2C3E50;
        margin-bottom: 10px;
        font-weight: bold;
        text-align: left;
    }

    /*progressbar*/
    #progressbar {
        margin-bottom: 0px;
        overflow: hidden;
        color: #0c0c0c;
    }

        #progressbar .active {
            color: #fff;
            background-color: #872e7b !important;
        }

        #progressbar li {
            list-style-type: none;
            font-size: 12px;
            width: 20%;
            float: left;
            position: relative;
        }

            /*ProgressBar before any progress*/
            #progressbar li:before {
                width: 50px;
                height: 50px;
                line-height: 45px;
                display: block;
                font-size: 18px;
                color: #ffffff;
                background: lightgray;
                border-radius: 50%;
                margin: 0 auto 10px auto;
                padding: 2px;
            }

            /*ProgressBar connectors*/
            #progressbar li:after {
                content: '';
                width: 100%;
                height: 2px;
                background: lightgray;
                position: absolute;
                left: 0;
                top: 25px;
                z-index: -1;
            }

            /*Color number of the step and the connector before it*/
            #progressbar li.active:before, #progressbar li.active:after {
                background: skyblue;
            }

    /*Imaged Radio Buttons*/
    .radio-group {
        position: relative;
        margin-bottom: 25px;
    }

    .radio {
        display: inline-block;
        width: 204;
        height: 104;
        border-radius: 0;
        background: lightblue;
        box-shadow: 0 2px 2px 2px rgba(0, 0, 0, 0.2);
        box-sizing: border-box;
        cursor: pointer;
        margin: 8px 2px;
    }

        .radio:hover {
            box-shadow: 2px 2px 2px 2px rgba(0, 0, 0, 0.3);
        }

        .radio.selected {
            box-shadow: 1px 1px 2px 2px rgba(0, 0, 0, 0.1);
        }

    .choose-source .connector-details .container .connector .connector-info {
        padding: 0.5rem;
        cursor: pointer;
        display: flex;
        height: inherit;
        flex-direction: column;
        align-items: center;
        justify-content: space-evenly;
        grid-gap: 0.5rem;
        gap: 0.5rem;
    }

    *:not(.p-inputtext):not(.p-button):focus {
        box-shadow: none !important;
    }

    *:not(.p-inputtext):not(.p-button):focus {
        box-shadow: none !important;
    }

    /*Fit image in bootstrap div*/
    .fit-image {
        width: 100%;
        object-fit: cover;
    }

    .choose-source .connector-details .container .connector .highlight {
        width: 140px;
        height: 130px;
        box-shadow: 0 2px 5px #0000004d;
        border: 4px solid #53adde;
        transition: .3s;
        border-radius: 5px;
    }

    .mandatory {
        color: red;
    }

    .col-md-12 {
        width: 100%;
    }

    .item {
        padding-left: 5px;
        padding-right: 5px;
    }

    .item-card {
        transition: 0.5s;
        cursor: pointer;
    }

    .item-card-title {
        font-size: 15px;
        transition: 1s;
        cursor: pointer;
    }

        .item-card-title i {
            font-size: 15px;
            transition: 1s;
            cursor: pointer;
            color: #ffa710
        }

    .card-title i:hover {
        transform: scale(1.25) rotate(100deg);
        color: #18d4ca;
    }

    .card:hover {
        transform: scale(1.05);
        box-shadow: 10px 10px 15px rgba(0,0,0,0.3);
    }

    .card-text {
        height: 80px;
    }

    .card::before, .card::after {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        transform: scale3d(0, 0, 1);
        transition: transform .3s ease-out 0s;
        background: rgba(255, 255, 255, 0.1);
        content: '';
        pointer-events: none;
    }

    .card::before {
        transform-origin: left top;
    }

    .card::after {
        transform-origin: right bottom;
    }

    .card:hover::before, .card:hover::after, .card:focus::before, .card:focus::after {
        transform: scale3d(1, 1, 1);
    }

    .btntestconn:hover {
        box-shadow: 0 0 0 2px white, 0 0 0 3px #616161;
    }

    #page-content-wrapper {
        padding: 15px;
        width: 80% !important;
    }

    .k-multiselect .k-multiselect-wrap {
        white-space: nowrap;
    }

    .tab-color {
        background-color: grey !important;
        padding: 12px;
        color:#fff;
    }

    .py-2 {
        padding-top: 0.5rem !important;
        padding-bottom: 0.5rem !important;
    }

    .px-3 {
        padding-left: 1rem !important;
        padding-right: 1rem !important;
    }

    .split-button .button-label[_ngcontent-vhm-c150] {
        border-bottom-right-radius: 4px;
        border-top-right-radius: 4px;
        display: inline-block;
        width: max-content;
    }

    .py-2 {
        padding-top: 0.5rem !important;
        padding-bottom: 0.5rem !important;
    }

    .px-3 {
        padding-left: 1rem !important;
        padding-right: 1rem !important;
    }

    .bg-blue-400 {
        background-color: #0fc9b7 !important;

    }

    .text-white {
        color: #fff !important;
    }

    .cursor-pointer {
        cursor: pointer !important;
    }

    .border-none {
        border-width: 0 !important;
        border-style: none;
    }

    .h6, h6 {
        font-size: 15px;
        color: black;
        text-align: right;
    }

    .hide-selected > div.k-input-values {
        display: none;
    }

    .myPopup-footer {
        position: absolute;
        bottom: 0;
        display: block;
        width: 95%;
        margin-top: 50px;
        padding: 6px 0 10px;
        text-align: right;
        border-top: 1px solid #e5e5e5;
    }

    button[disabled], html input[disabled]
    {
        background: #0fc9b759 !important;
        cursor: default !important;
    }
</style>
@*<div class="container-fluid" id="grad1">
    <div class="row justify-content-center mt-0">
        <div class="text-center p-0 mt-3 mb-2">
            <div class="card1 px-0 pt-4 pb-0 mt-3 mb-3">

                <div class="row">
                    <div class="col-md-12 mx-0">
                        <form id="msform">
                            <ul id="progressbar" style="padding: 8px;padding-left: 0px;">
                                <li class="active tab-color" id="choosedata"><strong>Pipeline</strong></li>
                                <li class="tab-color" id="condition"><strong>Conditions</strong></li>
                                <li class="tab-color" id="finalization"><strong>Finalization</strong></li>
                            </ul>
                            <fieldset>
                                <div class="form-card" style="height: 71vh;width:170vh;">
                                    <div class="row">
                                        <div class="col-sm-4" style="width: 33.33333333%;padding-left: 0%;">
                                            <input class="form-control" type="text" id="txt_ppl_gid" name="txt_ppl_gid" hidden />
                                            <input class="form-control" type="text" id="txt_ppl_code" name="txt_ppl_code" hidden />
                                            <label class="form-label">PipeLine Name </label>
                                            <span class="mandatory">*</span>
                                            <input class="form-control" id="txtppl_name" type="text" name="pipeline" />
                                        </div>
                                        <div class="col-sm-4">
                                            <label>Connectors</label>
                                            <span class="mandatory">*</span>
                                            <select class="form-control" id="connectors" onchange="getdblist($('#connectors').val())" name="ConnectorsId" style="width:100%;">
                                                <option value="">-- Select --</option>
                                                @foreach (var connector in ViewBag.Connectors)
                                                {
                                                    <option value="@connector.Id">@connector.Name</option>
                                                }
                                            </select>
                                        </div>
                                        <div class="col-sm-4">
                                            <label>Source DataBase Name</label>
                                            <span class="mandatory">*</span>
                                            <select class="form-control" onchange="gettableviewlist($('#connectors').val(),$('#databasename').val())" id="databasename" name="databasename">
                                            </select>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-sm-4" style="width: 33.33333333%;padding-left: 0%;">
                                            <label>Source Table/View</label>
                                            <span class="mandatory">*</span>
                                            <div>
                                                <select class="form-control" id="srctblview" name="srctblview"></select>
                                            </div>
                                        </div>
                                        <div class="col-sm-4">
                                            <label class="pay">Target Data Set</label>
                                            <span class="mandatory">*</span>
                                            <select class="form-control" id="trgdataset" name="trgdataset" style="width:100%;">
                                                <option value="">-- Select --</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div style="margin-top: 14px;margin-bottom: -7px;">
                                            <button type="button" id="btn_addnew" onclick="pplsave()" class="split-button text-white cursor-pointer border-none outline-none p-shadow-3 bg-blue-600">
                                                <span class="button-icon py-2 px-3" style="background-color:#007DC0 !important;">
                                                    <i class="glyphicon glyphicon-plus "></i>
                                                </span><span class="button-label py-2 px-3 bg-blue-400">Add New</span>
                                            </button>
                                            <div id="myPopup" style="display:none; ">
                                                <div>
                                                    <h6 style="text-align: center;font-size: 17px;color: green;font-weight: 700;">
                                                        Source And Target Mapping
                                                    </h6>

                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <label class="pay">Target Field</label>
                                                            <span class="mandatory">*</span>
                                                            <select class="form-control" id="trgfield" name="trgfield" style="width:100%;">
                                                                <option value="">-- Select --</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-sm-6">
                                                            <label class="pay">Source Field</label>
                                                            <span class="mandatory">*</span>
                                                            <select class="form-control" id="srcfield" name="srcfield" style="width:100%;">
                                                                <option value="">-- Select --</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <label class="form-label">Extraction criteria</label>
                                                            <span class="mandatory">*</span>
                                                            <input class="form-control" id="txt_extract_criteria" type="text" style="width:100%;" name="Extraction_criteria" />
                                                        </div>
                                                        <div class="col-sm-6">
                                                            <label class="form-label">Default Value</label>
                                                            <input class="form-control" id="txt_default_value" type="text" style="width:100%;" name="default_value" />
                                                        </div>
                                                    </div>
                                                    <div class="row" style="margin-top: 6%;">
                                                        <div class="col-sm-6" style="text-align: right;">
                                                            <input id="savePopup" name="savePopup" onclick="PPLfieldMapSave()" value="Save" type="button" style="padding: 5px 25px;border: none;background: #48a332;font-weight: bold;color: white;"></input>
                                                        </div>
                                                        <div class="col-sm-6">
                                                            <input id="closePopup" name="closePopup" onclick="srctrgclose()" value="Close" type="button" style="padding: 5px 25px;border: none;background:red;font-weight: bold;color: white;"></input>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row" id="search">
                                            </div>
                                        </div>

                                    </div>
                                </div>
                                <div class="navbar fixed-bottom" style="min-height:0px;"></div>

                                <input style="float: right;margin-right: -2%;" type="button" id='next' name="next" onclick="drpkeyfield()" class="next action-button" value="Next" />

                            </fieldset>
                            <fieldset>
                                <div class="form-card" style="height: 71vh;width:170vh;">
                                    <div>
                                        <label style="color:brown">
                                            Pipelinename-> @ViewData["infopplname"];
                                            Connectorname-> @ViewData["infoconname"];
                                            Source-> @ViewData["infosrctbl"];
                                        </label>
                                    </div>
                                    <h2 class="fs-title">Conditions</h2>
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <label>Key Field</label>
                                            <span class="mandatory">*</span>
                                            <input class="form-control" type="text" id="txt_pplcondition_gid" name="txt_pplcondition_gid" hidden />
                                            <select class="form-control" id="keyfield" name="keyfield" style="width:100%;">
                                                <option value="">-- Select --</option>
                                            </select>
                                        </div>
                                        <div class="col-sm-6">
                                            <img id="imgmysql" src="/Content/images/mysql.png" alt="My Image" hidden>
                                            <img id="imgpostgres" src="/Content/images/postgres.png" alt="My Image" hidden>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label class="form-label">Extraction Condition</label>
                                            <textarea id="txt_dflcond" name="txt_dflcond" onchange="previousfin()" rows="4" cols="50" style="width: 466px; height: 142px;color: black;"></textarea>
                                        </div>
                                        <div class="col-sm-6">
                                            <button style="margin-top: 17%;background-color: #0c83e7;color: black;" onclick="checkquery()" type="button" name="validatequery">Validate Query</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="navbar fixed-bottom" style="min-height:0px;"></div>
                                <input style="float: right;margin-right: 10%;" type="button" name="previous" id="previous" class="previous action-button-previous" value="Previous" />
                                <input style="float: right;margin-right: -22%;" type="button" onclick="pplcondsave()" name="con_nxt" id="con_nxt" class="next action-button" value="Next" disabled />
                            </fieldset>
                            <fieldset>
                                <div class="form-card" style="height: 71vh;width:170vh;">
                                    <label style="color:brown">
                                        Pipelinename-> @ViewData["infopplname"];
                                        Connectorname-> @ViewData["infoconname"];
                                        Source-> @ViewData["infosrctbl"];
                                    </label>
                                    <h2 class="fs-title">Finalization</h2>
                                    <div class="row" style="margin-top:1%">
                                        <div class="col-md-4">
                                            <input class="form-control" type="text" id="txt_pplfinalization_gid" name="txt_pplfinalization_gid" hidden />
                                            <label class="form-label">Run Type</label>
                                            <span class="mandatory">*</span><br />
                                            <input type="radio" id="on_demand" name="run_type" value="on_demand" onclick="showscheduled()" checked> On Demand
                                            <input type="radio" id="scheduled_run" name="run_type" value="scheduled_run" onclick="showscheduled()" style="margin-left:8%"> Scheduled Run
                                        </div>
                                        <div class="col-md-6" style="display:none;" id="Scheduled_expression">
                                            <label class="form-label">Scheduled Cron Expression</label>
                                            <span class="mandatory">*</span>
                                            <input class="form-control" id="txt_cronexpr" type="text" placeholder="Ex:-5 4 * * *" name="txt_cronexpr" />
                                        </div>
                                    </div>
                                    <div class="row" style="margin-top:1%">
                                        <div class="col-md-8">
                                            <label class="form-label">Extract Mode</label>
                                            <span class="mandatory">*</span><br />
                                            <input type="radio" id="incremental_rec" value="incremental_rec" name="extract_mode" onclick="showincremental()" checked> Incremental records
                                            <input type="radio" id="pulllastxdays" value="pulllastxdays" name="extract_mode" onclick="showincremental()" style="margin-left:8%"> Pull last X days
                                            <input type="radio" id="pullallrec" value="pullallrec" name="extract_mode" onclick="showincremental()" style="margin-left:8%"> Pull all records
                                        </div>
                                    </div>
                                    <div class="row" style="margin-top: 1%;display:none;" id="updatedtimestamp">
                                        <div class="col-sm-4">
                                            <label>Updated Time Stamp</label>
                                            <span class="mandatory">*</span>
                                           <select class="form-control" id="updtimestamp" name="updtimestamp" style="width:100%;">
                                                <option value="">-- Select --</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row" style="margin-top: 1%; display: none;" id="txt_pulllastxdays">
                                        <div class="col-md-4">
                                            <label class="form-label">Pull Days</label>
                                            <span class="mandatory">*</span>
                                            <input class="form-control" id="txt_pulllstxdays" value="0" type="text" name="txt_pulllstxdays" />
                                        </div>
                                    </div>
                                    <div class="row" style="margin-top:1%" id="drp_uploadmode">
                                        <div class="col-sm-4">
                                            <label>Upload Mode</label>
                                            <span class="mandatory">*</span>
                                            <select class="form-control" id="upload_mode" name="upload_mode">
                                                <option>--select--</option>
                                                <option selected>Insert or Update based on Primary key</option>
                                                <option>Clean and Insert based on Primary key</option>
                                                <option>Reject duplicate records</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <input style="float: right;margin-right: 10%;" type="button" name="fin_prvus" id="fin_prvus" onclick="previousfin()" class="previous action-button-previous" value="Previous" />
                                <input style="float: right;margin-right: -22%;" onclick="pplfinsave()" type="button" name="next" class="next action-button" value="Submit" />

                            </fieldset>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
*@

<body>
    <div>
        <div style="height:auto;">
            <div class="content-wrapper" style="padding:10px;">
                <div class="card1">
                    <div class="row">
                        <div class="col-md-12 mx-0">
                            <form id="msform">
                                <ul id="progressbar" style="padding: 8px 0px;">
                                    <li class="active tab-color" id="choosedata"><strong>Pipeline</strong></li>
                                    <li class="tab-color" id="condition"><strong>Conditions</strong></li>
                                    <li class="tab-color" id="finalization"><strong>Finalization</strong></li>
                                </ul>
                                <fieldset>
                                    <div class="form-card" style="height: 70vh;">
                                        <div class="row">
                                            <div class="col-sm-4" style="width: 33.33333333%;padding-left: 0%;">
                                                <input class="form-control" type="text" id="txt_ppl_gid" name="txt_ppl_gid" style="display:none" />
                                                <input class="form-control" type="text" id="txt_ppl_code" name="txt_ppl_code" style="display:none" />
                                                <label class="form-label">PipeLine Name </label>
                                                <span class="mandatory">*</span>
                                                <input class="form-control" id="txtppl_name" type="text" name="pipeline" />
                                            </div>
                                            <div class="col-sm-4">
                                                <label>Connectors</label>
                                                <span class="mandatory">*</span>
                                                <select class="form-control" id="connectors" onchange="getdblist($('#connectors').val())" name="ConnectorsId" style="width:100%;">
                                                    <option value="">-- Select --</option>
                                                    @foreach (var connector in ViewBag.Connectors)
                                                    {
                                                        <option value="@connector.Id">@connector.Name</option>
                                                    }
                                                </select>
                                            </div>
                                            <div class="col-sm-4">
                                                <label>Source DataBase Name</label>
                                                <span class="mandatory">*</span>
                                                <select class="form-control" onchange="gettableviewlist($('#connectors').val(),$('#databasename').val())" id="databasename" name="databasename">
                                                </select>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-sm-4" style="width: 33.33333333%;padding-left: 0%;">
                                                <label>Source Table/View</label>
                                                <span class="mandatory">*</span>
                                                <div>
                                                    <select class="form-control" id="srctblview" name="srctblview"></select>
                                                </div>
                                            </div>
                                            <div class="col-sm-4">
                                                <label class="pay">Target Data Set</label>
                                                <span class="mandatory">*</span>
                                                <select class="form-control" id="trgdataset" name="trgdataset" style="width:100%;">
                                                    <option value="">-- Select --</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div style="margin-top: 14px;margin-bottom: -7px;">
                                                <button type="button" id="btn_addnew" onclick="pplsave()" class="split-button text-white cursor-pointer border-none outline-none p-shadow-3 bg-blue-600">
                                                    <span class="button-icon py-2 px-3" style="background-color:#175650 !important;">
                                                        <i class="glyphicon glyphicon-plus "></i>
                                                    </span><span class="button-label py-2 px-3 bg-blue-400">Add New</span>
                                                </button>
                                                <div id="myPopup" style="display:none; ">
                                                    <div>
                                                        @*<h6 id="new" style="margin-top:-9px;">Mode: New</h6>
                                                        <h6 id="edit" style="margin-top:-9px;display:none;">Mode: Edit</h6>*@
                                                        <h6 style="text-align: center;font-size: 17px;color: green;font-weight: 700;">
                                                            Source And Target Mapping
                                                        </h6>

                                                        <div class="row">
                                                            <div class="col-sm-6">
                                                                <label class="pay">Target Field</label>
                                                                <span class="mandatory">*</span>
                                                                <select class="form-control" id="trgfield" name="trgfield" style="width:100%;">
                                                                    <option value="">-- Select --</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-sm-6">
                                                                <label class="pay">Source Field</label>
                                                                <span class="mandatory">*</span>
                                                                <select class="form-control" id="srcfield" name="srcfield" style="width:100%;">
                                                                    <option value="">-- Select --</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-sm-6">
                                                                <label class="form-label">Extraction criteria</label>
                                                                <span class="mandatory">*</span>
                                                                <input class="form-control" id="txt_extract_criteria" type="text" style="width:100%;" name="Extraction_criteria" />
                                                            </div>
                                                            <div class="col-sm-6">
                                                                <label class="form-label">Default Value</label>
                                                                <input class="form-control" id="txt_default_value" type="text" style="width:100%;" name="default_value" />
                                                            </div>
                                                        </div>
                                                        <div class="row" style="margin-top: 6%;">
                                                            <div class="col-sm-6" style="text-align: right;">
                                                                <input id="savePopup" name="savePopup" onclick="PPLfieldMapSave()" value="Save" type="button" style="padding: 5px 25px;border: none;background: #48a332;font-weight: bold;color: white;"></input>
                                                            </div>
                                                            <div class="col-sm-6">
                                                                <input id="closePopup" name="closePopup" onclick="srctrgclose()" value="Close" type="button" style="padding: 5px 25px;border: none;background:red;font-weight: bold;color: white;"></input>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row" id="search">
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="navbar fixed-bottom" style="min-height:0px;"></div>

                                    <input style="float: right;margin-right: 0%;" type="button" id='next' name="next" onclick="drpkeyfield()" class="next action-button" value="Next" />

                                </fieldset>

                                <fieldset>
                                    <div class="form-card" style="height: 70vh;">
                                        <div>
                                            <label style="color:brown">
                                                Pipelinename-> @ViewData["infopplname"];
                                                Connectorname-> @ViewData["infoconname"];
                                                Source-> @ViewData["infosrctbl"];
                                            </label>
                                        </div>
                                        <h2 class="fs-title">Conditions</h2>
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <label>Key Field</label>
                                                <span class="mandatory">*</span>
                                                <input class="form-control" type="text" id="txt_pplcondition_gid" name="txt_pplcondition_gid" style="display:none" />
                                                <select class="form-control" id="keyfield" name="keyfield" style="width:100%;">
                                                    <option value="">-- Select --</option>
                                                </select>
                                            </div>
                                            <div class="col-sm-6">
                                                <img id="imgmysql" src="/Content/images/mysql.png" alt="My Image" style="display:none">
                                                <img id="imgpostgres" src="/Content/images/postgres.png" alt="My Image" style="display:none">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label class="form-label">Extraction Condition</label>
                                                <textarea id="txt_dflcond" name="txt_dflcond" onchange="previousfin()" rows="4" cols="50" style="width: 497px; height: 142px; border: 1px solid #d2d6de;  border-radius: 4px;color: black;"></textarea>
                                            </div>
                                            <div class="col-sm-6">
                                                @*<button style="margin-top: 17%;background-color: #0c83e7;color: black;" type="button" name="validatequery" value="Validate Query" />*@
                                                <button style="margin-top: 17%; background-color: #0fc9b7; padding: 10px; border: unset;  border-radius: 5px; color: #fff;" onclick="checkquery()" type="button" name="validatequery">
                                                    Validate Query
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="navbar fixed-bottom" style="min-height:0px;"></div>
                                    <input style="float: right;margin-right: 12%;" type="button" name="previous" id="previous" class="previous action-button-previous" value="Previous" />
                                    <input style="float: right;margin-right: -22%;" type="button" onclick="pplcondsave()" name="con_nxt" id="con_nxt" class="next action-button" value="Next" disabled />
                                </fieldset>
                                <fieldset>
                                    <div class="form-card" style="height: 70vh;">
                                        <label style="color:brown">
                                            Pipelinename-> @ViewData["infopplname"];
                                            Connectorname-> @ViewData["infoconname"];
                                            Source-> @ViewData["infosrctbl"];
                                        </label>
                                        <h2 class="fs-title">Finalization</h2>
                                        <div class="row" style="margin-top:1%">
                                            <div class="col-md-4">
                                                <input class="form-control" type="text" id="txt_pplfinalization_gid" name="txt_pplfinalization_gid" style="display:none" />
                                                <label class="form-label">Run Type</label>
                                                <span class="mandatory">*</span><br />
                                                <input type="radio" id="on_demand" name="run_type" value="on_demand" onclick="showscheduled()" checked> On Demand
                                                <input type="radio" id="scheduled_run" name="run_type" value="scheduled_run" onclick="showscheduled()" style="margin-left:8%"> Scheduled Run
                                            </div>
                                            <div class="col-md-6" style="display:none;" id="Scheduled_expression">
                                                <label class="form-label">Scheduled Cron Expression</label>
                                                <span class="mandatory">*</span>
                                                <input class="form-control" id="txt_cronexpr" type="text" placeholder="Ex:-5 4 * * *" name="txt_cronexpr" />
                                            </div>
                                        </div>
                                        <div class="row" style="margin-top:1%">
                                            <div class="col-md-8">
                                                <label class="form-label">Extract Mode</label>
                                                <span class="mandatory">*</span><br />
                                                <input type="radio" id="incremental_rec" value="incremental_rec" name="extract_mode" onclick="showincremental()" checked> Incremental records
                                                <input type="radio" id="pulllastxdays" value="pulllastxdays" name="extract_mode" onclick="showincremental()" style="margin-left:8%"> Pull last X days
                                                <input type="radio" id="pullallrec" value="pullallrec" name="extract_mode" onclick="showincremental()" style="margin-left:8%"> Pull all records
                                            </div>
                                        </div>
                                        <div class="row" style="margin-top: 1%;display:none;" id="updatedtimestamp">
                                            <div class="col-sm-4">
                                                <label>Updated Time Stamp</label>
                                                <span class="mandatory">*</span>
                                                <select class="form-control" id="updtimestamp" name="updtimestamp" style="width:100%;">
                                                    <option value="">-- Select --</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row" style="margin-top: 1%; display: none;" id="txt_pulllastxdays">
                                            <div class="col-md-4">
                                                <label class="form-label">Pull Days</label>
                                                <span class="mandatory">*</span>
                                                <input class="form-control" id="txt_pulllstxdays" value="0" type="text" name="txt_pulllstxdays" />
                                            </div>
                                        </div>
                                        <div class="row" style="margin-top:1%" id="drp_uploadmode">
                                            <div class="col-sm-4">
                                                <label>Upload Mode</label>
                                                <span class="mandatory">*</span>
                                                <select class="form-control" id="upload_mode" name="upload_mode">
                                                    <option>--select--</option>
                                                    <option selected>Insert or Update based on Primary key</option>
                                                    <option>Clean and Insert based on Primary key</option>
                                                    <option>Reject duplicate records</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <input style="float: right;    margin-right: 12.5%;" type="button" name="fin_prvus" id="fin_prvus" onclick="previousfin()" class="previous action-button-previous" value="Previous" />
                                    <input style="float: right;margin-right: -22%;" onclick="pplfinsave()" type="button" name="next" class="next action-button" value="Submit" />

                                </fieldset>
                            </form>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</body>



<script>
    $(document).ready(function () {
        loadgrid([]);
        loadtrgtbl();
        $("#updatedtimestamp").show();

        (function ($) {
            var MultiSelectBox = window.kendo.ui.DropDownList.extend({
                _select: function (li) { },//Prevents highlighting
                _blur: function () { },//Prevents auto close
            });

            window.kendo.ui.plugin(MultiSelectBox);
        })(jQuery);

        gettableviewlist();
        loadtrgtbl();
        fetchppl();

        function onSelect(e) {
            var cbs = document.getElementsByName("cb");
            var checkboxes = document.getElementsByTagName('input');
            var ddl = $("#id").data("kendoDropDownList");
            var id = ddl.element.attr("id");
            multiselect();
            var item = e.item;
            var index = item.index();
            if (index == 0) {
                for (var i = 1; i < cbs.length; i++) {
                    var selectAll = cbs[0].checked;
                    if (cbs[0].checked) {
                        for (var i = 0; i < checkboxes.length; i++) {
                            if (checkboxes[i].type == 'checkbox') {
                                checkboxes[i].checked = true;
                            }
                        }
                        multiselect();
                    }

                    else {
                        for (var i = 0; i < checkboxes.length; i++) {
                            if (checkboxes[i].type == 'checkbox') {
                                checkboxes[i].checked = false;
                            }
                        }
                        multiselect();
                    }
                }
            }

        }

        function multiselect() {
            // var dataItem = this.dataItem(e.item);
            var ddl = $("#id").data("kendoDropDownList");
            var isAllChecked = $('#cb').prop("checked");
            var cbs = document.getElementsByName("cb");
            var display;

            var list = [];
            for (var i = 1; i < cbs.length; i++) {
                if (cbs[i].checked) {
                    list.push(cbs[i].value);
                }

            }

            if (list.length == 0) {
                display = "-- SelectAll --";
            }
            else {

                display = list.join(", ");
            }

            ddl.text(display);

        }

        var current_fs, next_fs, previous_fs; //fieldsets
        var opacity;

        $(".next").click(function () {

            current_fs = $(this).parent();
            next_fs = $(this).parent().next();

            $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
            $("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");

            current_fs.hide();
            next_fs.show();
            current_fs.animate({ opacity: 0 }, {
                step: function (now) {
                    opacity = 1 - now;

                    current_fs.css({
                        'display': 'none',
                        'position': 'relative'
                    });
                    next_fs.css({ 'opacity': opacity });
                },
                duration: 600
            });
        });

        $(".previous").click(function () {
            current_fs = $(this).parent();
            previous_fs = $(this).parent().prev();

            $("#progressbar li").eq($("fieldset").index(previous_fs)).addClass("active");
            $("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");

            current_fs.hide();
            previous_fs.show();

            current_fs.animate({ opacity: 0 }, {
                step: function (now) {
                    opacity = 1 - now;

                    current_fs.css({
                        'display': 'none',
                        'position': 'relative'
                    });
                    previous_fs.css({ 'opacity': opacity });
                },
                duration: 600
            });
        });

        $('.radio-group .radio').click(function () {
            $(this).parent().find('.radio').removeClass('selected');
            $(this).addClass('selected');
        });

        $(".submit").click(function () {
            return false;
        })

        var dsviewname = new kendo.data.DataSource({
            data: [],
            sort: { field: "ViewName", dir: "asc" }
        });

        $("#multiselect1").kendoMultiSelect({
            dataSource: dsviewname,
            autoHeight: true,
            autoClose: false,
            filter: "contains",
            downArrow: true,
            noDataTemplate: $("#noDataTemplate").html()
        });

    });


</script>
<script>
    function GetSourceDBType(conn_code) {

        $.ajax({
            type: 'GET',
            url: "../Pipeline/GetsrcDbType?Connection_code=" + conn_code,
            contentType: false,
            processData: false,
            cache: false,
            success: function (response) {
                if (response.source_db_type == "MySql") {
                    $("#imgmysql").removeAttr("hidden");
                }
                else if (response.source_db_type == "Postgres") {
                    $("#imgpostgres").removeAttr("hidden");
                }
                else {
                    $("#imgmysql").attr("hidden", true);
                    $("#imgpostgres").attr("hidden", true);
                }
            },
            error: function (er) {
                jAlert(er, "Error");
            }
        });
    }

    function fetchppl() {
        var id = @ViewBag.pipeline_id;
        if (id == "" || id == "0") {
            id = $('#txt_ppl_gid').val();
        }
        if (id != "") {
            $.ajax({
                type: "GET",
                url: "../Pipeline/Readpipeline?id=" + id,
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (response) {
                    $('#txt_ppl_gid').val(response.pipeline_gid);
                    $('#txt_ppl_code').val(response.pipeline_code);
                    $('#txtppl_name').val(response.pipeline_name);
                    var defaultValue = response.connection_code;
                    $('#connectors').val(defaultValue);
                    GetSourceDBType(defaultValue);
                    getdblist(defaultValue);
                    var db_name = response.db_name;
                    gettableviewlist(defaultValue, db_name);
                    loadtrgtbl();
                    TablefieldGriddata();
                    setTimeout(function () {
                        $('#databasename').val((response.db_name).toString());
                        $('#srctblview').val((response.table_view_name).toString());
                        $('#trgdataset').val(response.dataset_code + '-' + response.table_view_name);
                    }, 1000);
                },
                error: function (er) {
                    jAlert(er, "Error");
                }
            });
        }
    }

    function onChangeformid() {
        var selectedOptions = document.getElementById('required').selectedOptions;
        var selectedValues = Array.from(selectedOptions).map(option => option.value);

        console.log(selectedValues);
    }

    function loadgrid(data1) {
        try {

            $("#TablefieldGrid").remove();
            $('#search').append('<div id="TablefieldGrid" style="width: 96%; height: 240px!important; margin-top: 15px;margin-left: 13px;"></div>');
            $("#TablefieldGrid").kendoGrid({
                dataSource: {
                    data: data1,
                    schema: {
                        model: {
                            fields: {
                                pplfieldmapping_gid: { type: "string" },
                                pipeline_code: { type: "string" },
                                ppl_field_name: { type: "string" },
                                dataset_field_name: { type: "string" },
                                dataset_field_desc: { type: "string" },
                                extraction_criteria: { type: "string" },
                                default_value: { type: "string" },
                                Action: { type: "String" },
                            }
                        }
                    },
                    pageSize: 10,
                },
                pageable: true,
                sortable: true,
                filterable: true,
                selectable: "single",
                columns: [
                    {
                        field: "pplfieldmapping_gid",
                        title: "pplfieldmapping_gid",
                        width: 20,
                        hidden: true
                    },
                    {
                        field: "pipeline_code",
                        title: "pipeline_code",
                        width: 200,
                        hidden: true
                    },
                    {
                        field: "dataset_field_name",
                        title: "Target Field Name",
                        width: 200,
                        hidden: true
                    },
                    {
                        field: "dataset_field_desc",
                        title: "Target Field Name",
                        width: 200
                    },
                    {
                        field: "ppl_field_name",
                        title: "Source Field Name",
                        width: 200
                    },
                    {
                        field: "extraction_criteria",
                        title: "Extraction Criteria",
                        width: 200
                    },
                    {
                        field: "default_value",
                        title: "Default Value",
                        width: 200
                    },
                    {
                        field: "Action",
                        title: "Action",
                        template: "<i class='glyphicon glyphicon-trash' onclick='deletepplfieldmap($(this))' style='color:red;margin-left: 40% !important'></i>",
                        width: 80
                    }],
                editable: "inline",
            });
        }
        catch (err) {
            jAlert(er, "Error");
        }
    }

    function TablefieldGriddata() {
        var ppl_code = $('#txt_ppl_code').val();
        $.ajax({
            type: 'GET',
            url: "../Pipeline/Readpplfieldmap?pipeline_code=" + ppl_code,
            contentType: false,
            processData: false,
            cache: false,
            success: function (response) {
                loadgrid(response);
            },
            error: function (er) {
                jAlert(er, "Error");
            }
        });
    }

    function deletepplfieldmap(e) {
        let text = "Are you sure to delete?";
        jConfirm(text, "Connector", function (f) {
            if (f == true) {
                var entityGrid = $("#TablefieldGrid").data("kendoGrid");
                var pplfieldmap_gid = entityGrid.dataItem(e.select().closest("tr")).pplfieldmapping_gid;
                $.ajax({
                    type: "Delete",
                    url: "../Pipeline/Deleteexistingpplfieldmap?id=" + pplfieldmap_gid,
                    dataType: "json",
                    contentType: 'application/json; charset=utf-8',
                    success: function (response) {
                        jAlert(response, "Connector", function (g) {
                            if (g == true) {
                                location.reload();
                            }
                        });
                        //jAlert(response, "Connector");
                        //alert(response);
                    },
                    error: function (er) {
                        jAlert(er, "Error");
                    }
                });
            }
            else {
                text = "You canceled!";
            }
        });

    }

    btn_addnew.addEventListener("click", function () {
        myPopup.classList.add("show");
    });

    function pplsave() {
        var current_date = new Date;
        var conn_code = document.getElementById("connectors");
        var v_conn_code = conn_code.value;

        var db_name = document.getElementById("databasename");
        var v_db_name = db_name.value;

        var src_tbl = document.getElementById("srctblview");
        var v_src_table = src_tbl.value;

        var trg_tbl = document.getElementById("trgdataset");
        var v_trg_table = trg_tbl.value;
        v_trg_table = v_trg_table.toString().split('-')[0];
        if ($("#txt_ppl_gid").val() == "") {
            var insppl = {};
            insppl.pipeline_gid = "0";
            insppl.pipeline_name = $("#txtppl_name").val();
            insppl.connection_code = v_conn_code;
            insppl.db_name = v_db_name;
            insppl.table_view_name = v_src_table;
            insppl.dataset_code = v_trg_table;
            insppl.created_date = current_date;
            insppl.created_by = "Admin";
            var insppl1 = insppl;

            $.ajax({
                type: "Post",
                url: '@Url.Action("Addnewpipeline","Pipeline")',
                data: JSON.stringify(insppl1),
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (response) {
                    $('#txt_ppl_gid').val(response);
                    setTimeout(function () {
                        fetchppl();
                    }, 600);
                },
                error: function (er) {
                    jAlert(er, "Error");
                }
            });
        }
        else {
            if (v_trg_table == "" || v_trg_table == null || v_trg_table == undefined) {
                jAlert("please select target field.", "Connector");
                $("#myPopup").hide();
                return
            }
            else if (v_src_table == "" || v_src_table == null || v_src_table == undefined) {
                jAlert("please select source field.", "Connector");
                $("#myPopup").hide();
                return
            }
            else {
                var updppl = {};
                updppl.pipeline_gid = $("#txt_ppl_gid").val();
                updppl.pipeline_name = $("#txtppl_name").val();
                updppl.connection_code = v_conn_code;
                updppl.db_name = v_db_name;
                updppl.table_view_name = v_src_table;
                updppl.dataset_code = v_trg_table;
                updppl.updated_date = current_date;
                updppl.updated_by = "Admin";
                var updppl1 = updppl;

                $.ajax({
                    type: "Post",
                    url: '@Url.Action("Updateexistingpipeline","Pipeline")',
                    data: JSON.stringify(updppl1),
                    dataType: "json",
                    contentType: 'application/json; charset=utf-8',
                    success: function (response) {
                        //alert(response);
                        fetchppl();
                    },
                    error: function (er) {
                        jAlert(er, "Error");
                    }
                });
            }
        }

        $("#myPopup").kendoWindow();
        var dialog = $("#myPopup").data("kendoWindow");
        dialog.open().element.closest(".k-window").css({
            top: 214,
            left: 520,
            height: 255,
            width: 500,

        });
        trgtablefields(v_trg_table);
        setTimeout(function () {
            srctablefields(v_conn_code, v_db_name, v_src_table);
        }, 600);
    }

    function srctablefields(connection_code, databasename, sourcetable) {
        $.ajax({
            type: 'GET',
            url: "../Pipeline/GetSourceTableFielddrp?conn_code=" + connection_code + "&dbname=" + databasename +
                "&srctable=" + sourcetable,
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                console.log(data)
                var select = $("#srcfield");

                // Clear existing options
                select.empty();
                // Add new options from the JSON data
                select.append($("<option>").attr("value", "").text("-- Select --"));

                $.each(data, function (index, item) {
                    select.append($("<option>").attr("value", item.id).text(item.name));
                });

            },
            error: function (er) {
                jAlert(er, "Error");
            }
        });
    }

    function trgtablefields(dataset_code) {
        $.ajax({
            type: 'GET',
            url: "../Pipeline/GetTargetTableFielddrp?dataset_code=" + dataset_code,
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                console.log(data)
                var select = $("#trgfield");

                // Clear existing options
                select.empty();
                // Add new options from the JSON data
                select.append($("<option>").attr("value", "").text("-- Select --"));

                $.each(data, function (index, item) {
                    select.append($("<option>").attr("value", item.dataset_field_name).text(item.dataset_field_desc));
                });

            },
            error: function (er) {
                jAlert(er, "Error");
            }
        });
    }

    function srctrgclose() {
        $("#myPopup").data("kendoWindow").close();
        window.location.href = "../Pipeline/PipelineNew?id=" + $("#txt_ppl_gid").val();
    }
    function drpkeyfield() {
        var conn_code = document.getElementById("connectors");
        var v_conn_code = conn_code.value;

        var db_name = document.getElementById("databasename");
        var v_db_name = db_name.value;

        var trg_tbl = document.getElementById("trgdataset");
        var v_trg_table = trg_tbl.value;
        v_trg_table = v_trg_table.toString().split('-')[1];

        $.ajax({
            type: 'GET',
            url: "../Pipeline/GetKeyFielddrp?conn_code=" + v_conn_code + "&dbname=" + v_db_name + "&table_name=" + v_trg_table,
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                console.log(data)
                var select = $("#keyfield");

                // Clear existing options
                select.empty();
                // Add new options from the JSON data
                select.append($("<option>").attr("value", "").text("-- Select --"));

                $.each(data, function (index, item) {
                    select.append($("<option>").attr("value", item.name).text(item.name));
                });
                fetchpplcondition();
            },
            error: function (er) {
                jAlert(er, "Error");
            }
        });
    }

    function tablefieldlist() {

        var conn_code = document.getElementById("connectors");
        var v_conn_code = conn_code.value;

        var db_name = document.getElementById("databasename");
        var v_db_name = db_name.value;

        var src_tbl = document.getElementById("srctblview");
        var v_src_table = src_tbl.value;

        var trg_tbl = document.getElementById("trgdataset");
        var v_trg_table = trg_tbl.value;

        if (v_src_table == "" || v_src_table == null) {
            jAlert("Please select source table name.", "Connector");
            return
        }

        if (v_trg_table == "" || v_trg_table == null) {
            jAlert("Please select target data set.", "Connector");
            return
        }

        $.ajax({
            type: 'GET',
            url: "../Pipeline/GetTableFieldlist?conn_code=" + v_conn_code + "&dbname=" + v_db_name +
                "&srctable=" + v_src_table + "&trgtable=" + v_trg_table,
            contentType: false,
            success: function (response) {
                loadgrid(response);
            },
            error: function (er) {
                jAlert(er, "Error");
            }
        });
    }

    function PPLfieldMapSave() {
        var current_date = new Date;

        var src_tbl = document.getElementById("srcfield");
        var v_src_tbl = src_tbl.value;

        var trg_tbl = document.getElementById("trgfield");
        var v_trg_tbl = trg_tbl.value;

        if (v_trg_tbl == "" || v_trg_tbl == null || v_trg_tbl == undefined) {
            jAlert("please select target field.", "Connector");
            return
        }
        else if (v_src_tbl == "" || v_src_tbl == null || v_src_tbl == undefined) {
            jAlert("please select source field.", "Connector");
            return
        }

        var inspplmap = {};
        inspplmap.pplfieldmapping_gid = "0";
        inspplmap.pipeline_code = $("#txt_ppl_code").val();
        inspplmap.ppl_field_name = v_src_tbl
        inspplmap.dataset_field_name = v_trg_tbl;
        inspplmap.extraction_criteria = $("#txt_extract_criteria").val();
        inspplmap.default_value = $("#txt_default_value").val();
        inspplmap.created_date = current_date;
        inspplmap.created_by = "Admin";

        $.ajax({
            type: "Post",
            url: '@Url.Action("Addnewpplfieldmap","Pipeline")',
            data: JSON.stringify(inspplmap),
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            success: function (response) {
                jAlert(response, "Connector", function (e) {
                    if (e == true) {
                        var selectsrcfield = document.getElementById("srcfield");
                        selectsrcfield.selectedIndex = -1;
                        var selecttrgfield = document.getElementById("trgfield");
                        selecttrgfield.selectedIndex = -1;
                        $("#txt_extract_criteria").val("");
                        $("#txt_default_value").val("");
                        srctrgclose();
                    }
                });
            },
            error: function (er) {
                jAlert(er, "Error");
            }
        });
    }

    function pplcondsave() {
        var selected = [];
        var res1 = [];
        var current_date = new Date;
        var data = {};
        var conn_code = document.getElementById("connectors");
        var v_conn_code = conn_code.value;

        var db_name = document.getElementById("databasename");
        var v_db_name = db_name.value;

        var src_tbl = document.getElementById("srctblview");
        var v_src_table = src_tbl.value;

        var key_field = document.getElementById("keyfield");
        var v_key_field = key_field.value;

        srcupdatetimestampfields(v_conn_code, v_db_name, v_src_table);

        setTimeout(function () {
            if (v_key_field == "" || v_key_field == undefined || v_key_field == null) {
                jAlert("please select Key field.", "Connector");
                return true;
            }
            else {
                //for (var option of document.getElementById('keyfield').options) {
                //    if (option.selected) {
                //        selected.push(option.value);

                //    }
                //}
                //for (var i = 0; i < selected.length; i++) {
                //    var res = selected[i];
                //    var dropvalues = '{"keyfield": "' + res + '"}';
                //    res1.push(dropvalues);
                //}

                data.pipeline_code = $("#txt_ppl_code").val();
                data.key_field = v_key_field;//res1.toString();
                data.default_condition = $("#txt_dflcond").val();

                if ($("#txt_pplcondition_gid").val() == "") {
                    data.pplcondition_gid = "0";
                    data.created_date = current_date;
                    data.created_by = "Admin";

                    $.ajax({
                        type: "Post",
                        url: '@Url.Action("Addnewpplcondition","Pipeline")',
                        data: JSON.stringify(data),
                        dataType: "json",
                        contentType: 'application/json; charset=utf-8',
                        success: function (response) {
                            fetchpplcondition();
                        },
                        error: function (er) {
                            jAlert(er, "Error");
                        }
                    });
                }
                else {
                    data.pplcondition_gid = $("#txt_pplcondition_gid").val();
                    data.updated_date = current_date;
                    data.updated_by = "Admin";

                    $.ajax({
                        type: "Post",
                        url: '@Url.Action("Updateexistingpplcondition","Pipeline")',
                        data: JSON.stringify(data),
                        dataType: "json",
                        contentType: 'application/json; charset=utf-8',
                        success: function (response) {
                            fetchpplcondition();
                        },
                        error: function (er) {
                            jAlert(er, "Error");
                        }
                    });
                }
            }
            fetchpplfinalization();
        }, 600);
    }

    function fetchpplcondition() {
        //Fetch Pipeline Condition
        var ppl_code = $('#txt_ppl_code').val();

        $.ajax({
            type: "GET",
            url: "../Pipeline/ReadpipelineCondition?pipelinecode=" + ppl_code,
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            success: function (response) {
                if (response != null) {
                    $('#keyfield').val(response.key_field);
                    $('#txt_pplcondition_gid').val(response.pplcondition_gid);
                    $('#txt_dflcond').val(response.default_condition);
                }
            },
            error: function (er) {
                jAlert(er, "Error");
            }
        });
    }

    function srcupdatetimestampfields(connection_code, databasename, sourcetable) {
        $.ajax({
            type: 'GET',
            url: "../Pipeline/GetSrcUpdatetimestampFielddrp?conn_code=" + connection_code + "&dbname=" + databasename +
                "&srctable=" + sourcetable,
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                console.log(data)
                var select = $("#updtimestamp");

                // Clear existing options
                select.empty();
                // Add new options from the JSON data
                select.append($("<option>").attr("value", "").text("-- Select --"));

                $.each(data, function (index, item) {
                    select.append($("<option>").attr("value", item.id).text(item.name));
                });

            },
            error: function (er) {
                jAlert(er, "Error");
            }
        });
    }

    function pplfinsave() {

        var current_date = new Date;
        var data = {};

        var updtmstamp = document.getElementById("updtimestamp");
        var v_updtmstamp = updtmstamp.value;

        var upldmode = document.getElementById("upload_mode");
        var v_upldmode = upldmode.value;

        data.pipeline_code = $("#txt_ppl_code").val();
        data.run_type = $('input[name="run_type"]:checked').val();
        data.cron_expression = $("#txt_cronexpr").val();
        data.extract_mode = $('input[name="extract_mode"]:checked').val();
        data.updated_time_stamp = v_updtmstamp;
        data.pull_days = parseInt($("#txt_pulllstxdays").val(), 10);
        data.upload_mode = v_upldmode;

        if ($("#txt_pplfinalization_gid").val() == "") {
            data.finalization_gid = "0";
            data.created_date = current_date;
            data.created_by = "Admin";

            $.ajax({
                type: "Post",
                url: '@Url.Action("Addnewpplfinalization","Pipeline")',
                data: JSON.stringify(data),
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (response) {
                    jAlert(response, "Connector", function (g) {
                        if (g == true) {
                            window.location.href = "../Pipeline/PipelineList";
                        }
                    });
                },
                error: function (er) {
                    jAlert(er, "Error");
                }
            });
        }
        else {
            data.finalization_gid = $("#txt_pplfinalization_gid").val();
            data.updated_date = current_date;
            data.updated_by = "Admin";

            $.ajax({
                type: "Post",
                url: '@Url.Action("Updateexistingpplfinalization","Pipeline")',
                data: JSON.stringify(data),
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (response) {
                    jAlert(response, "Connector", function (g) {
                        if (g == true) {
                            window.location.href = "../Pipeline/PipelineList";
                        }
                    });
                    //alert(response);
                    //window.location.href = "../Pipeline/PipelineList";
                },
                error: function (er) {
                    jAlert(er, "Error");
                }
            });
        }
    }

    function fetchpplfinalization() {
        var ppl_code = $('#txt_ppl_code').val();

        $.ajax({
            type: "GET",
            url: "../Pipeline/ReadpipelineFinalization?pipelinecode=" + ppl_code,
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            success: function (response) {
                if (response.length > 0) {

                    $('#txt_pplfinalization_gid').val(response[0].finalization_gid);
                    //$("input[type=radio][name=run_type]").prop("checked", false);
                    $("input[name=run_type][value=" + (response[0].run_type) + "]").attr('checked', 'checked');
                    showscheduled();
                    //$("input[type=radio][name=extractmode]").prop("checked", false);
                    $("input[name=extract_mode][value=" + (response[0].extract_mode) + "]").attr('checked', 'checked');
                    showincremental();
                    $('#txt_cronexpr').val(response[0].cron_expression);
                    $('#updtimestamp').val((response[0].updated_time_stamp).toString());
                    $('#txt_pulllstxdays').val(response[0].pull_days);
                    $('#upload_mode').val((response[0].upload_mode).toString());

                }
            },
            error: function (er) {
                jAlert(er, "Error");
            }
        });
    }

    function checkquery() {
        var conn_code = $('#connectors').val();
        var database_name = $('#databasename').val();
        var src_table = $('#srctblview').val();
        var query = "select count(*) from " + src_table + " where 1=1 ";
        var condition = $('#txt_dflcond').val();
        if (condition != "" || condition != null || condition != undefined) {
            query = query + condition;
        }

        $.ajax({
            type: "GET",
            url: "../Pipeline/IsCheckQuery?conn_code=" + conn_code + "&dbname=" + database_name +
                "&extractionquery=" + query,
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            success: function (response) {
                if (response == true) {
                    jAlert("Validation Success..!", "Connector");
                    $("#con_nxt").prop("disabled", false);
                }
                else {
                    jAlert("Validation Failed..!", "Connector");
                    $("#con_nxt").prop("disabled", true);
                }
            },
            error: function (er) {
                jAlert(er, "Error");
            }
        });
    }

    function previousfin() {
        $("#con_nxt").prop("disabled", true);
    }

</script>

<script>
    function getdblist(connection_code) {
        var e = document.getElementById("connectors");
        var value = e.value;
        var text = e.options[e.selectedIndex].text;

        $.ajax({
            type: "GET",
            url: "../Pipeline/Getconndblist?connection_code=" + connection_code,
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                console.log(data)
                var select = $("#databasename");

                // Clear existing options
                select.empty();
                // Add new options from the JSON data
                select.append($("<option>").attr("value", "").text("-- Select --"));

                $.each(data, function (index, item) {
                    select.append($("<option>").attr("value", item.name).text(item.name));
                });

            },
            error: function (er) {
                jAlert(er, "Error");
            }
        });
    }

    function gettableviewlist(connection_code, database_name) {
        var e = document.getElementById("connectors");
        var conn_code = e.value;

        var e1 = document.getElementById("databasename");
        var dbname = e1.value;

        $.ajax({
            type: "GET",
            url: "../Pipeline/Gettableviewlist?connection_code=" + connection_code + "&database_name=" + database_name,
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                console.log(data)
                var select = $("#srctblview");

                // Clear existing options
                select.empty();

                // Add new options from the JSON data
                select.append($("<option>").attr("value", "").text("-- Select --"));

                $.each(data, function (index, item) {
                    select.append($("<option>").attr("value", item.name).text(item.name));
                });

            },
            error: function (er) {
                jAlert(er, "Error");
            }
        });

    }

    function loadtrgtbl() {
        $.ajax({
            type: "GET",
            url: "../Pipeline/GetTargetTablelist",
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                console.log(data)
                var select = $("#trgdataset");

                // Clear existing options
                select.empty();

                // Add new options from the JSON data
                select.append($("<option>").attr("value", "").text("-- Select --"));

                $.each(data, function (index, item) {
                    select.append($("<option>").attr("value", item.dataset_code).text(item.dataset_name));
                });

            },
            error: function (er) {
                jAlert(er, "Error");
            }
        });
    }

    function editbtn(e) {
        //$("#new").hide();
        //$("#edit").show();
        myPopup.classList.add("show");
        var grid = $("#ordersGrid").data("kendoGrid");
        var _row = $(e).parents("tr");
        var Cells = _row.children("td");
        var table_field = Cells[0].innerText;
        var db_alias = Cells[1].innerText;
        var extraction_criertia = Cells[2].innerText;
        var default_vlaue = Cells[3].innerText;

        $("#table_field").val(table_field);
        $("#dbalias_name").val(db_alias);
        $("#Extraction_criteria").val(extraction_criertia);
        $("#default_value").val(default_vlaue);
        $("#savePopup").text('Update');

    }

</script>
<script>
    function showscheduled() {
        if ($('#scheduled_run').is(':checked')) {
            $("#Scheduled_expression").show();
        }
        else {
            $("#Scheduled_expression").hide();
        }
    }

    function showincremental() {
        if ($('#incremental_rec').is(':checked')) {
            $("#updatedtimestamp").show();
            $("#txt_pulllastxdays").hide();
        }
        if ($('#pulllastxdays').is(':checked')) {
            $("#updatedtimestamp").show();
            $("#txt_pulllastxdays").show();
        }
        if ($('#pullallrec').is(':checked')) {
            $("#updatedtimestamp").hide();
            $("#txt_pulllastxdays").hide();

        }
    }

    function addNew(widgetId, value) {
        var widget = $("#" + widgetId).getKendoMultiSelect();
        var dataSource = widget.dataSource;
        console.log(dataSource.length)


        if (confirm("Are you sure?")) {
            dataSource.add({
                Id: dataSource.data().length + 1,
                sportName: value
            });

            var currentValue = widget.value();
            currentValue.push(dataSource.data().length)
            widget.value(currentValue);
            widget.trigger("change");
        }
    };

</script>